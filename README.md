# راهنمای نصب آرچ

این مطلب در راستای کمک به نصب آرچ لینوکس تهیه شده است.  
در این روش آرچ را به صورت efi و با systemdboot نصب خواهیم کردم.
و از فایل سیستم btrfs استفاده میکنیم.

---

## قدم اول: تهیه فایل ISO و ساختن یک فلش bootable از آن

- ابتدا به [صفحه‌ی دانلود آرچ](https://archlinux.org/download/) مراجعه کنید و فایل ایزو را به همراه signature مربوطه دانلود کنید.

- سپس با استفاده از [GnuPG](https://wiki.archlinux.org/title/GnuPG) فایل ایزوی دانلود شده را تست کنید تا از صحت آن اطمینان حاصل شود.  
    بدین صورت `تائید امضا` را بررسی کنید:

    `gpg --keyserver-options auto-key-retrieve --verify archlinux-version-x86_64.iso.sig`

  <details>
  <summary>تائید امضا</summary>

  مطابق اطلاعات [این لینک](https://www2.cs.arizona.edu/stork/packagemanagersecurity/attacks-on-package-managers.html)
  در صورتی که پکیج‌ها بروز رسانی نشوند امکان آلوده شدن آنها به بدافزارها افزایش پیدا می‌کند.
  بدین جهت پکیج‌مینجرها طوری طراحی شدند تا پکیج‌ها(بسته‌ها) را به صورت خودکار بروزرسانی کنند.
  اما در صورتی که خود این پکیج‌منیجرها از قبل آلوده باشند امکان اینکه مجددا بسته‌های آلوده به سیستم اضافه کنند یا بسته‌های آلوده‌ی قدیمی را درست بروزرسانی نکنند وجود خواهد داشت.
  پکیج‌منیجرها معمولا با دسترسی‌های بالا و بدون محدودیت اجرا می‌شوند تا قادر به اعمال تغییرات و بروزرسانی در سطوح مختلف سیستم باشند؛
  بنابراین، اقدامات مدیر بسته بر کل سیستم تأثیر می گذارد.

  </details>

- بوت‌ایبل کرن فلش یواس‌بی  
  برای اینکار روشهای زیادی وجود داره و برنامه‌های گرافیکی هم هستن که کار رو ساده‌تر کردن اما روش ترمینالی اینکار استفاده از دستور زیر هست:  
   ‍‍
    `dd bs=4M if=path/to/archlinux-version-x86_64.iso of=/dev/sdx conv=fsync oflag=direct status=progress`  

  برای اطلاعات بیشتر می‌تونید [این لینک](https://wiki.archlinux.org/title/USB_flash_installation_medium#Using_the_ISO_as_is_(BIOS_and_UEFI)) رو مطالعه کنید.
  
  <details>
  <summary>نحوه‌ی بوت شدن به فلش</summary>

  - ممکنه سیستم شما به Secure Boot حساس باشه و در نتیجه نتونه از روش فلش بوت بشه پس باید این وضعیت رو از منوی بایوس خاموش کنید.
  برای اینکار سیستم رو ری‌استارت کنید و دکمه‌ی اف۱۲ یا اف۸ یا اف۲ رو بزنید تا وارد منوی بایوس بشین بین تب‌های موجود حرکت کنید و این وضعیت رو خاموش کنید.

  - ممکنه سیستم شما روی حالت uefi قرار نداشته باشه و درنتیجه بازم نمیتونه از روی فلش بوت بشه پس از منوی بایوس این حالت رو فعال کنید.

  - *No Bootable Device*  
  بعد از نصب سیستم و تموم شدن کار اگر ری‌استارت کردین و خطایی دیدن که سیستم نتونسته یک فایل بوت پیدا کنه بازم باید وارد منوی بایوس بشین و
  از روی گزینه‌ای که برای انتخاب Trusted bootloaders هست وارد بشین و فایل بگردین فایل bootx64.efi رو انتخاب کنید براش یک اسم دلخواه بذارین و تنظمیات رو ذخیره کنید و ری‌استارت کنید.
  
  </details>

- برای اینکه مطمئن بشیم فلش ما به صورت efi بوت شده دستور زیر رو میزنیم:  

  ‍`ls /sys/firmware/efi/efivars`

  اگر این دستور خروجی نداشته باشه یعنی درحال حاضر این فلش به صورت efi بوت‌ایبل و درنتیجه بوت نشده پس باید دوباره مراحل قبلی رو طی کنید.
