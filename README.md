# راهنمای نصب آرچ

این مطلب در راستای کمک به نصب آرچ لینوکس تهیه شده  
در این روش آرچ را به صورت efi و با systemdboot نصب و از فایل سیستم btrfs استفاده می‌کنیم

 - سعی نمی‌کنم همه‌ی اصطلاحات رو ترجمه کنم و اکثرا کلمات انگلیسی رو فقط فارسی می‌نویسم تا دوستانی که با این کلمات آشنا نیستن هم خونده باشن، بعضی از این کلمات مثل `محیط اینتراکتیو` و موارد دیگه هم چون در عمل نشون داده میشه بهتر درک میشه و در آخر اینکه هرچی هم منابع فارسی پیدا کنید باز مجبورید یه روزی به سراغ منابع انگلیسی برید و خب آشنایی با کلمات انگلیسی اونجا کار رو ساده‌تر می‌کنه
  
---

## قدم اول: تهیه فایل ISO و ساختن یک فلش bootable از آن    

- ابتدا به [صفحه‌ی دانلود آرچ](https://archlinux.org/download/) مراجعه کنید و فایل ایزو را به همراه signature مربوطه دانلود کنید
- سپس با استفاده از [GnuPG](https://wiki.archlinux.org/title/GnuPG) فایل ایزوی دانلود شده رو با این روش `تائید امضا` بررسی کنید:  
> `gpg --keyserver-options auto-key-retrieve --verify archlinux-version-x86_64.iso.sig`  

 <details dir="rtl">
  <summary>تائید امضا</summary>

>  مطابق اطلاعات [این لینک](https://www2.cs.arizona.edu/stork/packagemanagersecurity/attacks-on-package-managers.html)
  در صورتی که پکیج‌ها بروز رسانی نشوند امکان آلوده شدن آنها به بدافزارها افزایش پیدا می‌کند
  بدین جهت پکیج‌مینجرها طوری طراحی شدند تا پکیج‌ها(بسته‌ها) را به صورت خودکار بروزرسانی کنند
  اما در صورتی که خود این پکیج‌منیجرها از قبل آلوده باشند امکان اینکه مجددا بسته‌های آلوده به سیستم اضافه کنند یا بسته‌های آلوده‌ی قدیمی را درست بروزرسانی نکنند وجود خواهد داشت.
  پکیج‌منیجرها معمولا با دسترسی‌های بالا و بدون محدودیت اجرا می‌شوند تا قادر به اعمال تغییرات و بروزرسانی در سطوح مختلف سیستم باشند؛
  بنابراین، اقدامات مدیر بسته بر کل سیستم تأثیر می گذارد

 </details>

- بوت‌ایبل کرن فلش    
  برای اینکار روشهای زیادی وجود داره و برنامه‌های گرافیکی هم هستن که کار رو ساده‌تر کردن اما روش ترمینالی اینکار استفاده از دستور زیر هست:  
   ‍‍
> `dd bs=4M if=path/to/archlinux-version-x86_64.iso of=/dev/sdx conv=fsync oflag=direct status=progress`  

   - برای اطلاعات بیشتر می‌تونید [این لینک](https://wiki.archlinux.org/title/USB_flash_installation_medium#Using_the_ISO_as_is_(BIOS_and_UEFI)) رو مطالعه کنید
  
 <details dir="rtl">
  <summary>خطاها‌ی زمان بوت شدن</summary>  

  ۱- ممکنه سیستم شما به Secure Boot حساس باشه و در نتیجه نتونه از روش فلش بوت بشه پس باید این وضعیت رو از منوی بایوس خاموش کنید
  برای اینکار سیستم رو ری‌استارت کنید و دکمه‌ی f12 یا f8 یا f2 رو بزنید تا وارد منوی بایوس بشین بین تب‌های موجود حرکت کنید و این وضعیت رو خاموش کنید

  ۲- ممکنه سیستم شما روی حالت uefi قرار نداشته باشه و درنتیجه بازم نمیتونه از روی فلش بوت بشه پس از منوی بایوس این حالت رو فعال کنید

  ۳- خطای *No Bootable Device*  
  بعد از نصب سیستم و تموم شدن کار اگر ری‌استارت کردین و خطایی دیدن که سیستم نتونسته یک فایل بوت پیدا کنه بازم باید وارد منوی بایوس بشین و
  از روی گزینه‌ای که برای انتخاب Trusted bootloaders هست وارد بشین و فایل بگردین فایل bootx64.efi رو انتخاب کنید براش یک اسم دلخواه بذارین و تنظمیات رو ذخیره کنید و ری‌استارت کنید
  
 </details>

- برای اینکه مطمئن بشیم فلش ما به صورت efi بوت شده دستور زیر رو میزنیم:  

> `ls /sys/firmware/efi/efivars`

  اگر این دستور خروجی نداشته باشه یعنی درحال حاضر این فلش به صورت efi بوت‌ایبل و درنتیجه بوت نشده پس باید دوباره مراحل قبلی رو طی کنید

---

## اتصال به اینترنت

برای اتصال به اینرنت یا از کابل استفاده می‌کنید که خب نیاز به تنظیمات یا کارخاصی ندارید؛ یا از وای‌فای میخواین وصل بشین که روشی که توضیح میدم از ویکی آرچ اقتباس شده و همین رو پیش میریم:
  - دستور `ip link` رو بزنید تا ببینید دیوایس‌های سیستم شناخته شدن و فعال هستن  
  - دستور ‍`iwctl` رو بزنید تا وارد محیط اینتراکتیوش بشید. بعد از اینکه وارد محیط اینتراکتیوش بشین یک تغییر کوچیک توی ترمینال می‌بینید به این شکل:  
> [iwd]#
  - میتونید دستور `help` رو بزنید تا راهنمای این ابزار براتون بیاد و مطالعه کنید
  - برای اینکه دیوایس وایرلس سیستم رو پیدا کنید دستور `device list` رو بزنید
  - برای اینکه این دیوایس بتونه وای‌فای‌های اطراف پیدا کنه دستور `station device scan` که در اینجا کلمه‌ی *device* رو باید اسم دیوایس وایرلس سیستم خودتون عوض کنید
  - با دستور `station device get-networks` که دوباره کلمه‌ی دیواس رو باید اصلاح کنید، می‌بینید که چه وای‌فای‌هایی رو پیدا کرده
  - حالا با دستور `station device connect SSID` می‌تونید به وای‌فای مدنظرتون وصل بشین.(SSID = اسم وای‌فای، برای اسم وای‌فای چند کاراکتر اول رو بنویسید و دکمه تب کیبورد رو بزنید.)
  - اگر نیاز به پسورد برای وای‌فای باشه یک پرامپت باز میشه تا پسورد رو بگیره،‌ همچنین میتونید یکجا و در یک دستور بزنید(نیازی به گفتن نداره که `passphrase` دومی هم همون پسورد وای‌فای هست)  
> `iwctl --passphrase passphrase station device connect SSID`  
  - برای اطلاعات بیشتر به [این لینک](https://wiki.archlinux.org/title/Iwd#iwctl) از ویکی آرچ مراجعه کنید
  - با دستور پینگ چک کنید که به اینترنت وصل شدین یا نه
> `ping -c 4 archlinux.org`
  - ساعت سیستم رو تنظیم کنید `timedatectl set-ntp true`
---

## پارتیشن بندی دیسک

این قسمت شاید یکم با بقیه‌ی راهنماهای نصب آرچ فرق کنه و البته پارتیشن بندی یکم حواس جمع میخواد، که یهو نزنید دیسک رو فرمت کنید و فایلهاتون رو پاک کنید و وا ویلا نشه!  
نوع پارتیشن بندی رو btrfs انتخاب کردم که هم فایل سیستم جدیدی هست هم به ثبات خوبی رسیده و توزیع‌های مختلفی هم دارن پیش‌فرض از همین فایل سیستم استفاده می‌کنن
یا با نصاب‌های گرافیکی‌ای که دارن انتخابش رو ساده کردن. از امکاناتی که من قصد دارم استفاده کنم یکی برای فشرده کردن محتوای درایو هست و یکی هم برای اسنپ‌شات گرفتن 

  - دستور `fdisk -l‍` یا `lsblk` برای شناسایی درایوهای سیستم بزنید
  - حداقل دو تا پارتیشن لازم داریم. یکی برای efi و بوت شدن سیستم و یکی هم برای خود سیستم‌عامل و درایوهای هوم و غیره،‌ از ابزار `gdisk‍` یا `fdsik` برای پارتیشن بندی استفاده کنید. طرز کار ساده‌ای دارن، ابزارهای دیگه هم فرقی نداره استفاده بشن و مهم خروجی کار هست. نهایتا در خروجی کار همچین چیزی لازمه:

| partition  |      size       | filesystem-type| mount point |          partition          |
|   :---:    |      :---:      |     :---:      |     :---:   |            :---:            |
| boot       |      512M       | EFI system     | `/mnt/boot` | `/dev/efi_system_partition` |
| root       | remaining space | Linux file sys | `/mnt`      | `/dev/root_partition`       |

  - ساختن پارتیشن `swap` الزامی نیست و در بعضی از مقالات دیدم که به دلیلی که عملیات‌های نوشتن و پاک کردن(و نه خواندن) باعث میشن رفته رفته سلول‌های SSD پوشانده بشن، خب عملیات swap زیاد توشتن و پاک کردن داره وجودش روی SSD مضر هست. اما از طرفی با حجم رم‌های بالایی که سیسنم‌های امروزی در اختیار دارن شاید اصلا از swap در عمل استفاده‌ای هم نشه و من که هر وقت با free یا دستورات دیگر چک کردم ازش استفاده نشده بود. پس بیخیالش شدم و شما هم هرطور نظر خودتون هست پارتیشن یا فایل swap ایجاد کنید یا از خیرش بگذرید 
  - 








